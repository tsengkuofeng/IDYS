<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>姿勢回饋系統 - 監控端</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <style>
        :root {
            --bg-color: #FAF9F6;
            --accent-color: #800020;
            --text-color: #333333;
            --gray-light: #E0E0E0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Helvetica Neue", Arial, "PingFang TC", "Heiti TC", sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 彈窗與標題樣式 (維持不變) --- */
        #disclaimer-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 999; backdrop-filter: blur(5px); }
        .modal-content { background: var(--bg-color); padding: 40px; border-radius: 8px; max-width: 500px; text-align: center; border-top: 5px solid var(--accent-color); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .btn-primary { background-color: var(--accent-color); color: white; border: none; padding: 12px 30px; font-size: 16px; border-radius: 4px; cursor: pointer; transition: opacity 0.3s; }
        .btn-primary:hover { opacity: 0.9; }
        
        header { text-align: center; padding: 20px 0; border-bottom: 1px solid var(--gray-light); }
        h1 { margin: 0; font-weight: 700; color: var(--text-color); letter-spacing: 1px; }
        .subtitle { color: var(--accent-color); font-size: 14px; margin-top: 8px; font-weight: 500; }
        
        /* --- 主容器與設定卡片 --- */
        .main-container { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .setup-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 700px; text-align: center; margin-bottom: 20px; }
        
        .input-group { margin: 15px 0; text-align: left; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 13px; font-weight: bold; color: #666; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
        
        .camera-options { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .option-btn { background: transparent; border: 1px solid var(--accent-color); color: var(--accent-color); padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: all 0.2s; }
        .option-btn:hover { background: rgba(128,0,32,0.1); }
        .option-btn.active { background: var(--accent-color); color: white; }

        /* --- 影片格線系統 --- */
        #video-grid { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; width: 100%; margin-top: 20px; }
        .video-wrapper { position: relative; background: #000; border-radius: 8px; overflow: hidden; width: 320px; aspect-ratio: 3/4; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        /* 為單鏡頭時放大顯示 */
        .video-wrapper.single-mode { width: 480px; aspect-ratio: 4/3; }
        
        .overlay-label { position: absolute; top: 10px; left: 10px; background: rgba(128, 0, 32, 0.9); color: white; padding: 4px 10px; font-size: 12px; border-radius: 4px; z-index: 10; font-weight: bold; letter-spacing: 0.5px; }

        footer { text-align: center; padding: 15px; font-size: 12px; color: #888; border-top: 1px solid var(--gray-light); }
    </style>
</head>
<body>

    <div id="disclaimer-modal">
        <div class="modal-content">
            <h2 style="color:var(--accent-color); margin-top:0;">使用前聲明</h2>
            <p style="text-align:left; line-height:1.6; color:#555;">本系統為姿勢訓練回饋輔助工具，旨在協助優化運動軌跡。<br><br>若您有急性疼痛、舊傷復發或任何骨骼肌肉系統疾病，請務必停止使用並尋求專業醫師或物理治療師的協助。</p>
            <button class="btn-primary" onclick="document.getElementById('disclaimer-modal').style.display='none'">我了解，繼續</button>
        </div>
    </div>

    <header>
        <h1>姿勢回饋系統</h1>
        <div class="subtitle">你是我的眼，帶我矯正無數的姿勢</div>
    </header>

    <div class="main-container">
        <div class="setup-card" id="setup-panel">
            <h3>連線設定</h3>
            <p>請選擇您架設的鏡頭數量：</p>
            
            <div class="camera-options">
                <button class="option-btn active" onclick="setCamCount(1)">單鏡頭</button>
                <button class="option-btn" onclick="setCamCount(2)">雙鏡頭 (側+背)</button>
                <button class="option-btn" onclick="setCamCount(3)">三鏡頭 (全方位)</button>
            </div>

            <div id="inputs-area">
                <div class="input-group">
                    <label>鏡頭 ID</label>
                    <input type="text" id="cam1-id" placeholder="輸入手機 ID">
                </div>
            </div>

            <button class="btn-primary" onclick="startConnection()">開始連線</button>
        </div>

        <div id="video-grid"></div>
    </div>

    <footer>&copy; 2025年 北醫大兼任教練曾國峰製作</footer>

    <script>
        let currentMode = 1;

        function setCamCount(count) {
            currentMode = count;
            // 按鈕樣式切換
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach((b, index) => {
                if (index + 1 === count) b.classList.add('active');
                else b.classList.remove('active');
            });

            // 動態生成輸入框
            const area = document.getElementById('inputs-area');
            let html = '';
            
            if (count === 1) {
                html += createInput("cam1-id", "鏡頭 ID");
            } else if (count === 2) {
                html += createInput("cam1-id", "側面鏡頭 (矢狀面) - 偵測前傾");
                html += createInput("cam2-id", "背面鏡頭 (額狀面) - 偵測骨盆歪斜");
            } else if (count === 3) {
                html += createInput("cam1-id", "側面鏡頭 (矢狀面) - 偵測前傾");
                html += createInput("cam2-id", "背面鏡頭 (額狀面) - 偵測骨盆歪斜");
                html += createInput("cam3-id", "正面鏡頭 (額狀面) - 偵測膝蓋/腳踝");
            }
            area.innerHTML = html;
        }

        function createInput(id, label) {
            return `
                <div class="input-group">
                    <label>${label}</label>
                    <input type="text" id="${id}" placeholder="輸入手機 ID">
                </div>`;
        }

        function startConnection() {
            document.getElementById('setup-panel').style.display = 'none';
            const grid = document.getElementById('video-grid');
            grid.innerHTML = ''; // 清空

            const ids = [];
            const labels = [];

            if (currentMode === 1) {
                ids.push(document.getElementById('cam1-id').value);
                labels.push("主畫面");
            } else if (currentMode === 2) {
                ids.push(document.getElementById('cam1-id').value);
                ids.push(document.getElementById('cam2-id').value);
                labels.push("側面觀 (Side)");
                labels.push("背面觀 (Back)");
            } else {
                ids.push(document.getElementById('cam1-id').value);
                ids.push(document.getElementById('cam2-id').value);
                ids.push(document.getElementById('cam3-id').value);
                labels.push("側面觀 (Side)");
                labels.push("背面觀 (Back)");
                labels.push("正面觀 (Front)");
            }

            ids.forEach((id, index) => {
                if(id) createVideoBox(labels[index], id, currentMode === 1);
            });
            
            // TODO: 在此處呼叫 PeerJS 連線函式，目前僅顯示 UI 佔位
        }

        function createVideoBox(label, id, isSingle) {
            const grid = document.getElementById('video-grid');
            const div = document.createElement('div');
            // 如果是單鏡頭，加上 single-mode 類別讓畫面變大
            div.className = `video-wrapper ${isSingle ? 'single-mode' : ''}`;
            div.innerHTML = `
                <div class="overlay-label">${label}</div>
                <div style="color:#aaa; display:flex; flex-direction:column; justify-content:center; align-items:center; height:100%; font-size:14px;">
                    <div>連線中...</div>
                    <div style="font-size:12px; margin-top:5px; color:#555;">ID: ${id}</div>
                </div>
            `;
            grid.appendChild(div);
        }
    </script>
</body>
</html>